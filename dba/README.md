# DBA 岗位考核（线上 PostgreSQL 实战）

## 考核背景（业务场景）

假设你加入了一家小型技术团队，需要接手并负责一个 **已经在运行中的 PostgreSQL 数据库**。

该数据库：

* 当前规模不大（中小型业务）
* 已有基础业务数据
* 对数据可靠性有要求
* 未来 6～12 个月内，存在业务增长可能

你的角色是：**实际接手线上系统的 DBA / 数据库负责人**

你的目标是：

* 快速理解现状
* 找出主要风险
* 给出合理、可执行的优化与应急方案


## 四、考核环境说明

提供：

* 一个 **空的 PostgreSQL 数据库实例**
* 数据库连接信息（Host / Port / User / Password）
* 一个已部署的 **Adminer Web 管理界面**

你可以：

* 直接通过 Adminer 操作数据库
* ~~使用本地工具（psql / DBeaver / DataGrip 等）连接~~

⚠️ 注意事项：

* 该数据库为考核专用环境
* 允许你进行结构调整、索引调整、参数查看与说明
* 不要求、也不建议进行大规模破坏性实验


## 五、你的任务

### 业务权限与多产品数据库设计

#### 业务背景说明

当前数据库需要同时服务于以下两类业务：

1. **安答团队内部工具（OA 系统）**
   - 面向内部员工使用
   - 涉及用户管理、权限控制、操作审计等功能
   - 对数据安全与可追溯性要求较高
2. **安答智能体产品（对外业务）**
   - 面向外部用户
   - 存在多用户、多租户的可能性
   - 对系统稳定性、扩展性有要求

出于资源与运维成本考虑，**初期计划将两类业务部署在同一个 PostgreSQL 数据库实例中**。

### 权限与结构设计

请基于以上业务背景，设计一个 **合理、可扩展的数据库结构与权限控制方案**，并说明你的设计思路。

你需要重点回答以下问题：

1. **在同一个数据库实例中，如何区分内部业务与外部业务的数据？**
   - 是通过 schema、命名规范、逻辑隔离，还是其他方式？
   - 各种方式的优缺点是什么？
2. **如何设计用户与权限模型？**
   - 内部员工账号与外部用户账号是否共用同一套用户表？
   - 权限是基于角色（RBAC）、资源，还是其他模型？
   - 是否需要审计日志？如何设计？
3. **数据库层面的权限控制思路**
   - 是否使用不同数据库用户（DB User）？
   - 是否限制不同业务对表 / schema 的访问权限？
   - 在什么情况下需要数据库层面的隔离，而不仅是应用层？
4. **未来扩展与风险控制**
   - 如果外部产品用户量快速增长，你认为当前设计的瓶颈在哪里？
   - 在什么情况下，你会建议将两类业务拆分到不同数据库实例？

#### 本部分交付要求

- 请将你的设计方案写入单独文档（如 `PERMISSION_DESIGN.md`）
- 可使用：
  - 文字说明
  - 简单表结构示意
  - 权限关系示意（无需复杂图表）

我们更关注：

- 你的**设计逻辑**
- 你是否理解**业务边界**
- 你对“同库多业务”风险的判断能力

### 数据库运维与应急处理

#### 1️⃣ 数据库现状评估（Assessment）

请基于当前数据库状态，完成一次 **快速接手评估**，并输出文档（如 `ASSESSMENT.md`），说明：

* 当前数据库结构是否合理（表、字段、索引层面）
* 你认为 **最可能优先出问题的风险点** 是什么
* 哪些问题在当前业务阶段是可以接受的
* 哪些问题如果不处理，未来一定会出事故

重点不在“找得多”，而在于 **判断是否准确**。


#### 2️⃣ 数据库部署与配置优化（有限度）

请在你认为 **必要且合理** 的范围内，对数据库进行优化，包括但不限于：

* 数据目录与存储使用方式的分析与建议
* PostgreSQL 参数调整（**2～3 个即可**）

  * 例如内存、连接、WAL、checkpoint 等相关参数

要求：

* 不追求“参数大全”
* 每一项调整都需要说明：

  * 为什么调
  * 不调会有什么风险


#### 3️⃣ 备份与恢复方案设计（重点）

请为该数据库设计一套 **可落地的备份与恢复方案**，并说明你的思路：

* 备份策略

  * 是否使用全量 + 增量
  * 备份频率与保留周期
* 恢复方案设计

  * RPO（最多能丢多少数据）
  * RTO（多久可以恢复服务）

请说明在以下场景下你的处理流程：

* 误删部分业务数据
* 单表或单库损坏
* 整个数据库实例不可用

交付形式可以是：

* 文档说明
* 或示例脚本（如 `backup.sh` / `restore.sh`）


#### 4️⃣ 运维与应急说明（OPS.md）

请在 `OPS.md` 中回答以下问题（结合 PostgreSQL 实际情况）：

* **数据库磁盘空间持续增长 / 即将耗尽，你会如何排查和处理？**
* **发生误删数据时，你的标准处理流程是什么？**
* **如果业务 QPS 在短时间内明显上涨，你的应对思路是什么？**

我们更关注你的 **分析路径和优先级判断**，而不是“万能方案”。


### ⭐ 可选加分项（非必须）

* 主从复制或高可用（HA）设计思路
* 读写分离的适用场景分析
* 你会重点关注哪些 PostgreSQL 监控指标（无需实际部署）
* Linux / 存储 / IO 层面你会额外关注的问题


## 六、交付要求

请在 PR 中至少包含：

* 数据库设计方案（可提供 SQL 和在 adminer 界面中展示）
* 一份数据库评估文档（如 `ASSESSMENT.md`）
* 一份运维与应急说明（`OPS.md`）
* 你认为必要的配置说明或脚本

并在 PR 描述中说明：

* 你主要做了哪些改动或分析
* 哪些问题你选择暂不处理，以及原因
* 如果你正式接手该数据库，未来 1～3 个月的优化计划


## 七、我们重点关注什么？

* 你是否真正接手并运维过线上数据库
* 你是否具备清晰的风险与优先级意识
* 你是否理解数据库、Linux、存储、业务之间的关系
* 你是否站在业务角度思考

---

感谢你认真完成本次考核。
